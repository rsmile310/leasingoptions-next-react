{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useState } from 'react';\nimport style from './postcode-lookup.module.scss';\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { faSpinner } from \"@fortawesome/free-solid-svg-icons\";\nimport { DataLookupAPI } from \"API/DataLookupApi\";\nimport { joinNotEmpty } from \"helpers/stringHelper\";\n\nvar PostcodeLookup = function PostcodeLookup(_ref) {\n  var minQueryLength = _ref.minQueryLength,\n      excludeTownAndCounty = _ref.excludeTownAndCounty,\n      onAddressSelected = _ref.onAddressSelected;\n\n  var _useState = useState(false),\n      isLoading = _useState[0],\n      setIsLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      isActive = _useState2[0],\n      setIsactive = _useState2[1];\n\n  var _useState3 = useState([]),\n      searchResults = _useState3[0],\n      setSearchResults = _useState3[1];\n\n  var setTimeoutId = null;\n\n  var handleSearchInit = function handleSearchInit(evt) {\n    var searchQuery = evt.target.value.toString();\n    setIsactive(false);\n    setSearchResults([]); //Reset any pending (executing) requests\n\n    if (setTimeoutId) {\n      clearTimeout(setTimeoutId);\n    }\n\n    if (searchQuery && searchQuery.length >= 4) {\n      setIsLoading(true);\n      setTimeoutId = setTimeout(function () {\n        Promise.resolve(getSearchResults(searchQuery)).then(function (results) {\n          setIsactive(true);\n          setSearchResults(results);\n          setIsLoading(false);\n          setTimeoutId = null;\n        });\n      }, 50);\n    }\n  };\n\n  var handleSearchBlur = function handleSearchBlur() {\n    setTimeout(handleSearchClose, 250);\n  };\n\n  var handleSearchClose = function handleSearchClose() {\n    setIsactive(false);\n    setIsLoading(false);\n    setSearchResults([]);\n  };\n\n  var handleAddressSelect = function handleAddressSelect(address, evt) {\n    evt.stopPropagation();\n\n    if (onAddressSelected) {\n      if (!excludeTownAndCounty) {\n        onAddressSelected({\n          address1: address.addressline1,\n          address2: address.addressline2,\n          address3: address.addressline3,\n          town: address.posttown,\n          county: address.county,\n          postcode: address.postcode\n        });\n      } else {\n        onAddressSelected({\n          address1: address.addressline1,\n          address2: address.addressline2,\n          address3: joinNotEmpty(\", \", [address.addressline3, address.posttown, address.county]),\n          postcode: address.postcode\n        });\n      }\n    }\n  };\n\n  function getSearchResults(_x) {\n    return _getSearchResults.apply(this, arguments);\n  }\n\n  function _getSearchResults() {\n    _getSearchResults = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(searchQuery) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return DataLookupAPI.PostcodeLookup(searchQuery);\n\n            case 2:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _getSearchResults.apply(this, arguments);\n  }\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: style['input-wrapper'],\n    children: [/*#__PURE__*/_jsx(\"input\", {\n      type: \"text\",\n      className: \"form-control\",\n      placeholder: \"Postcode\",\n      onFocus: function onFocus(evt) {\n        handleSearchInit(evt);\n      },\n      onKeyUp: function onKeyUp(evt) {\n        handleSearchInit(evt);\n      },\n      onBlur: handleSearchBlur\n    }), isLoading ? /*#__PURE__*/_jsx(FontAwesomeIcon, {\n      icon: faSpinner,\n      className: \"fa-spin \".concat(style['input-loading'])\n    }) : \"\", /*#__PURE__*/_jsx(\"div\", {\n      className: \"\".concat(style['input-list'], \" \").concat(isActive ? style['is-active'] : \"\"),\n      children: /*#__PURE__*/_jsx(\"ul\", {\n        children: searchResults.map(function (item, index) {\n          return /*#__PURE__*/_jsx(\"li\", {\n            onClick: function onClick(evt) {\n              handleAddressSelect(item, evt);\n            },\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: item.summaryline\n            })\n          }, \"result-\".concat(index));\n        })\n      })\n    })]\n  });\n};\n\nexport default PostcodeLookup;","map":null,"metadata":{},"sourceType":"module"}