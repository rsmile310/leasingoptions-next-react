{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _ from 'underscore';\nimport { VehicleStorageTypes } from \"enums/VehicleStorageTypes\";\nimport { VehiclesStorageProvider } from \"helpers/vehiclesStorageProvider\";\nimport { isNullOrEmpty, getGUID } from \"helpers/helpers\";\nexport var HistoryStorageHelper = /*#__PURE__*/function () {\n  function HistoryStorageHelper() {\n    _classCallCheck(this, HistoryStorageHelper);\n  }\n\n  _createClass(HistoryStorageHelper, null, [{\n    key: \"addItem\",\n    value: function addItem(index, item, summary) {\n      if (item && index >= 0 && index < this.storageMaxSize) {\n        var storageItem = {\n          id: getGUID(),\n          index: index,\n          vehicle: item,\n          timeStamp: Date.now(),\n          summary: summary\n        };\n\n        if (VehiclesStorageProvider.addItem(this.storageType, storageItem, index)) {\n          return storageItem;\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"updateItem\",\n    value: function updateItem(itemId, item, alwaysUpdate, summary) {\n      if (item) {\n        var storageItem = VehiclesStorageProvider.getItem(this.storageType, itemId);\n\n        if (storageItem && (alwaysUpdate || !_.isEqual(storageItem.vehicle, item))) {\n          storageItem.vehicle = item;\n          storageItem.timeStamp = Date.now();\n          storageItem.summary = summary;\n\n          if (VehiclesStorageProvider.updateItem(this.storageType, storageItem)) {\n            return storageItem;\n          }\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"addOrUpdateItem\",\n    value: function addOrUpdateItem(item, summary) {\n      if (item) {\n        var storageItems = this.getItems(false);\n        var storageItem = storageItems.find(function (storageItem) {\n          return storageItem && storageItem.vehicle && storageItem.vehicle.vehicleRef === item.vehicleRef;\n        });\n\n        if (storageItem) {\n          return this.updateItem(storageItem.id, item, true, summary);\n        } else {\n          // If full, remove the oldest entry\n          if (this.isFull()) {\n            var _orderedStorageItems$;\n\n            var orderedStorageItems = _.sortBy(storageItems, function (orderedStorageItem) {\n              return orderedStorageItem.timeStamp;\n            });\n\n            var itemId = (_orderedStorageItems$ = orderedStorageItems[0]) === null || _orderedStorageItems$ === void 0 ? void 0 : _orderedStorageItems$.index;\n            this.removeItem(itemId);\n            this.addItem(itemId, item, summary);\n          } else {\n            var index = storageItems.indexOf(null);\n\n            if (!isNullOrEmpty(index) && index >= 0 && index < this.storageMaxSize) {\n              return this.addItem(index, item, summary);\n            }\n          }\n        }\n      }\n\n      return null;\n    }\n  }, {\n    key: \"removeItem\",\n    value: function removeItem(itemId) {\n      return VehiclesStorageProvider.removeItem(this.storageType, itemId);\n    }\n  }, {\n    key: \"getItems\",\n    value: function getItems(ignoreEmptyItems) {\n      var result = VehiclesStorageProvider.getItems(this.storageType);\n\n      if (result && result.length > 0 && ignoreEmptyItems) {\n        result = result.filter(function (item) {\n          return item;\n        });\n      }\n\n      return result;\n    }\n  }, {\n    key: \"countItems\",\n    value: function countItems() {\n      return this.getItems(true).length;\n    }\n  }, {\n    key: \"isFull\",\n    value: function isFull() {\n      return !(this.countItems() < this.storageMaxSize);\n    }\n  }, {\n    key: \"isTriggered\",\n    value: function isTriggered() {\n      return !(this.countItems() < this.triggerMaxSize);\n    }\n  }]);\n\n  return HistoryStorageHelper;\n}();\n\n_defineProperty(HistoryStorageHelper, \"storageType\", VehicleStorageTypes.History);\n\n_defineProperty(HistoryStorageHelper, \"storageMaxSize\", VehiclesStorageProvider.getStorageMaxSize(VehicleStorageTypes.History) || 0);\n\n_defineProperty(HistoryStorageHelper, \"triggerMaxSize\", VehiclesStorageProvider.getTriggerMaxSize(VehicleStorageTypes.History) || 0);","map":null,"metadata":{},"sourceType":"module"}